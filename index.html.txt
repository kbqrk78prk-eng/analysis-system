<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆ†æç³»çµ± V15 (ä¿®æ­£çµæœç‰ˆ)</title>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; margin: 0; padding: 10px; }
        #checker { background: #330000; color: #ff0000; padding: 5px; font-size: 14px; border-radius: 5px; margin-bottom: 10px; font-weight: bold; transition: 0.3s; }
        .box { background: #1a1a1a; padding: 12px; border-radius: 10px; border: 1px solid #333; margin-bottom: 8px; }
        .row { display: flex; gap: 8px; margin-bottom: 8px; }
        button { flex: 1; padding: 25px 0; font-size: 20px; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; }
        .btn-r { background: #ff3b30; color: #fff; }
        .btn-b { background: #007aff; color: #fff; }
        .btn-g { background: #34c759; color: #fff; }
        .btn-gray { background: #444; color: #fff; border: 1px solid #666; }
        #msg { color: #ffd700; font-size: 15px; margin-bottom: 8px; font-weight: bold; min-height: 1.2em; }
        .stats { display: flex; justify-content: space-around; background: #222; padding: 15px; border-radius: 10px; border: 1px solid #444; }
        .val-pos { color: #FFF9C4; font-size: 24px; font-weight: bold; }
        .val-neg { color: #007aff; font-size: 24px; font-weight: bold; }
        .win-rate { font-size: 12px; color: #aaa; margin-top: 5px; line-height: 1.4; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th { border-bottom: 2px solid #444; padding: 8px 0; color: #888; font-weight: normal; }
        td { border-bottom: 1px solid #333; padding: 12px 0; }
        .warn-active { background: #ff0000 !important; color: #fff !important; animation: blink 0.8s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body onload="checkSystem()">

    <div id="checker">âš ï¸ ç³»çµ±è¼‰å…¥ä¸­</div>
    <div id="msg">ğŸ”´ ç¬¬ä¸€æ­¥ï¼šè«‹é»æ“Šã€Œä¸Šä¸€å±€çµæœã€</div>

    <div class="box">
        <div class="row">
            <button class="btn-r" onclick="handleRes('èŠ')">èŠ</button>
            <button class="btn-b" onclick="handleRes('é–’')">é–’</button>
            <button class="btn-g" onclick="handleRes('å’Œ')">å’Œ</button>
        </div>
    </div>

    <div class="box">
        <div style="font-size:12px; color:#888; text-align:left; margin-bottom:5px;">â— æ­¥é©Ÿ 1ï¼šå°è·¯é¡è‰²</div>
        <div class="row">
            <button class="btn-gray" onclick="handleClr('S', 'ç´…')">å°ï¼šç´…</button>
            <button class="btn-gray" onclick="handleClr('S', 'è—')">å°ï¼šè—</button>
        </div>
        <div style="font-size:12px; color:#888; text-align:left; margin-bottom:5px; margin-top:10px;">â— æ­¥é©Ÿ 2ï¼šå¤§çœ¼è·¯é¡è‰²</div>
        <div class="row">
            <button class="btn-gray" onclick="handleClr('B', 'ç´…')">å¤§çœ¼ï¼šç´…</button>
            <button class="btn-gray" onclick="handleClr('B', 'è—')">å¤§çœ¼ï¼šè—</button>
        </div>
    </div>

    <div class="stats">
        <div>æ­£ç›ˆè™§<br><span id="vPos" class="val-pos">0</span>
            <div class="win-rate">å‹ç‡: <span id="pRate">0%</span><br>èŠ:<span id="pZ">0</span>|é–’:<span id="pX">0</span></div>
        </div>
        <div>åç›ˆè™§<br><span id="vNeg" class="val-neg">0</span>
            <div class="win-rate">å‹ç‡: <span id="nRate">0%</span><br>èŠ:<span id="nZ">0</span>|é–’:<span id="nX">0</span></div>
        </div>
        <div>ç¸½æ°´<br><span id="vReb" style="color:#ffd700; font-size:22px;">0</span>
            <div class="win-rate">å±€æ•¸: <span id="vTotal">0</span></div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="10%">å±€</th><th width="20%">è·¯è‰²</th><th width="20%">é æ¸¬</th><th width="20%">çµæœ</th><th width="30%">æ­£/åç›ˆè™§</th>
            </tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

<script>
    var lastP = "", sC = "", bC = "", count = 0, pS = 0, nS = 0, rS = 0;
    var pWins = 0, nWins = 0, totalValid = 0;
    var pLossStreak = 0, nLossStreak = 0;
    var pWinZ = 0, pWinX = 0, nWinZ = 0, nWinX = 0;
    
    // ç”¨ä¾†æš«å­˜ç•¶å‰é»æ“Šçš„çµæœï¼Œç›´åˆ°æŒ‰ä¸‹é¡è‰²æŒ‰éˆ•æ‰æ­£å¼çµç®—
    var currentRoundRes = ""; 

    function checkSystem() {
        var c = document.getElementById('checker');
        c.style.background = "#003300"; c.style.color = "#00ff00";
        c.innerText = "âœ… ç³»çµ±é‹ä½œæ­£å¸¸"; c.classList.remove("warn-active");
    }

    function triggerVibrate() { if ("vibrate" in navigator) { navigator.vibrate([200, 100, 200]); } }

    function handleClr(type, val) {
        if (!lastP) { alert("è«‹å…ˆè¨­å®šèµ·é»ï¼"); return; }
        if (type === 'S') sC = val; 
        if (type === 'B') bC = val;
        
        // å¦‚æœé¡è‰²éƒ½é¸å¥½äº†ï¼Œä¸”å·²ç¶“æœ‰çµæœï¼Œå‰‡åŸ·è¡Œçµç®—
        if (sC && bC && currentRoundRes) {
            finalizeRound();
        } else {
            document.getElementById('msg').innerText = "å·²é¸ å°è·¯:" + (sC||"-") + " | å¤§çœ¼:" + (bC||"-");
        }
    }

    function handleRes(res) {
        // å¦‚æœæ˜¯è¨­å®šèµ·é»
        if (lastP === "") {
            lastP = res; 
            document.getElementById('msg').innerText = "âœ… èµ·é»å·²è¨­ã€" + res + "ã€‘ï¼Œè«‹è¼¸å…¥é¡è‰²"; 
            return;
        }
        
        // é»æ“ŠçµæœæŒ‰éˆ•æ™‚ï¼Œåªæ˜¯æš«å­˜ï¼Œå…è¨±éš¨æ™‚æ›´æ›
        currentRoundRes = res;
        document.getElementById('msg').innerText = "ğŸ“ ç›®å‰çµæœè¨­ç‚ºã€" + res + "ã€‘ï¼Œè«‹è¼¸å…¥é¡è‰²çµç®—";
    }

    function finalizeRound() {
        var res = currentRoundRes;
        
        if (res === 'å’Œ') { 
            count++; 
            add(count, "--", "å’Œ", "å’Œ", "0/0"); 
            resetRound();
            return; 
        }

        var adv = (bC === 'è—') ? lastP : (lastP === 'èŠ' ? 'é–’' : 'èŠ');
        var anti = (adv === 'èŠ' ? 'é–’' : 'èŠ');
        var pWin = (adv === res);
        var nWin = (anti === res);
        
        if(pWin) { pWins++; pLossStreak = 0; if(res === 'èŠ') pWinZ++; else pWinX++; } else { pLossStreak++; }
        if(nWin) { nWins++; nLossStreak = 0; if(res === 'èŠ') nWinZ++; else nWinX++; } else { nLossStreak++; }
        totalValid++;

        var pG = pWin ? (res === 'èŠ' ? 475 : 500) : -500;
        var nG = nWin ? (res === 'èŠ' ? 475 : 500) : -500;
        pS += (pG + 5); nS += (nG + 5); rS += 5;

        // æ›´æ–° UI
        document.getElementById('vPos').innerText = Math.round(pS);
        document.getElementById('vNeg').innerText = Math.round(nS);
        document.getElementById('vReb').innerText = rS;
        document.getElementById('vTotal').innerText = totalValid;
        document.getElementById('pZ').innerText = pWinZ;
        document.getElementById('pX').innerText = pWinX;
        document.getElementById('nZ').innerText = nWinZ;
        document.getElementById('nX').innerText = nWinX;
        
        if(totalValid > 0) {
            document.getElementById('pRate').innerText = ((pWins / totalValid) * 100).toFixed(1) + "%";
            document.getElementById('nRate').innerText = ((nWins / totalValid) * 100).toFixed(1) + "%";
        }

        // é€£æ•—æé†’
        var c = document.getElementById('checker');
        if (pLossStreak >= 4 || nLossStreak >= 4) {
            c.innerText = "âš ï¸ " + (pLossStreak >= 4 ? "æ­£ä¸‹" : "åä¸‹") + " " + Math.max(pLossStreak, nLossStreak) + " é€£æ•—æé†’ï¼";
            c.className = "warn-active"; triggerVibrate();
        } else {
            checkSystem();
        }

        count++;
        add(count, sC + "|" + bC, adv, res, Math.round(pG) + "/" + Math.round(nG));
        
        // çµç®—å¾Œæ›´æ–°èµ·é»ä¸¦æ¸…ç©ºç•¶å‰é¸æ“‡
        lastP = res; 
        resetRound();
        document.getElementById('msg').innerText = "âœ… å·²çµç®—ï¼Œè«‹è¼¸å…¥ä¸‹ä¸€å±€çµæœ";
    }

    function resetRound() {
        sC = ""; bC = ""; currentRoundRes = "";
    }

    function add(idx, clr, adv, res, score) {
        var l = document.getElementById('list');
        var row = "<tr><td>"+idx+"</td><td>"+clr+"</td><td>"+adv+"</td><td>"+res+"</td><td>"+score+"</td></tr>";
        l.innerHTML = row + l.innerHTML;
    }
</script>
</body>
</html>
